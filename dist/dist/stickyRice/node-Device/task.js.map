{"version":3,"sources":["../../../stickyRice/node-Device/task.js"],"names":["page","require","create","system","fs","key","args","device","url","encodeURI","time","Date","now","data","length","console","log","content","read","JSON","parse","config","path","settings","userAgent","UA","viewportSize","width","height","clipRect","top","left","exists","remove","open","status","render","format","quality","code","msg","word","stringify","write","phantom","exit","includeJs","evaluate","result","total","$","i","len","list","title","find","text","trim","info","link","attr","pic","push","dataList"],"mappings":"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","file":"task.js","sourcesContent":["\"use strict\";\n\nvar page = require('webpage').create(),\n    system = require('system'),\n    fs = require('fs');\n\nvar key = system.args[1],\n    device = system.args[2] || '',\n    url = \"https://www.baidu.com/s?wd=\" + encodeURI(key),\n    time = Date.now(),\n    data = {};\n\nif (system.args.length === 1) {\n    console.log('请输入搜索词 ');\n} else {\n    //是否默认设备\n    if (device) {\n\n        var content = fs.read('device.json'),\n            content = JSON.parse(content);\n        var config = content[device],\n            path = device + '.png';\n        console.log(path);\n\n        //设置用户代理\n        page.settings.userAgent = config.UA;\n        //该属性可用于设置可视窗口的大小\n        page.viewportSize = {\n            width: config.width,\n            height: config.height\n        };\n        //该属性可以设置页面的可视范围\n        page.clipRect = {\n            top: 0,\n            left: 0,\n            width: config.width,\n            height: config.height\n        };\n\n        //检查文件名是否重复，重复删除\n        if (fs.exists(path)) {\n            fs.remove(path);\n            console.log(fs.exists(path));\n        }\n    }\n\n    page.open(url, function (status) {\n\n        page.render(device + '.png', { format: 'png', quality: '100' });\n        if (status !== \"success\") {\n            time = Date.now() - time;\n            data = {\n                code: 0, // 返回状态码，1为成功，0为失败\n                msg: '抓取失败', // 返回的信息\n                word: key, // 抓取的关键字\n                time: time, // 任务的时间\n                device: device\n            };\n            data = JSON.stringify(data, null, 4);\n            fs.write(\"task.json\", data, 'w');\n            phantom.exit();\n        } else {\n            time = Date.now() - time;\n            page.includeJs(\"https://code.jquery.com/jquery-3.1.1.min.js\", function () {\n\n                data = page.evaluate(function (time, key, device) {\n                    var result = [];\n                    var total = $('#results .result');\n\n                    for (var i = 0, len = total.length; i < len; i++) {\n                        var list = {};\n                        list.title = $(total[i]).find('.c-title').text().trim();\n                        list.info = $(total[i]).find('.c-abstract').text();\n                        list.link = $(total[i]).find('.c-container a:first').attr('href');\n                        var pic = $(total[i]).find('.c-img img');\n                        list.pic = pic && pic.length ? pic.attr('src') : '';\n                        result.push(list);\n                    }\n\n                    return JSON.stringify({\n                        code: 1,\n                        msg: '抓取成功',\n                        word: key,\n                        time: time,\n                        device: device,\n                        dataList: result\n\n                    }, null, 4);\n                }, time, key, device);\n                console.log(data);\n                fs.write(\"task.json\", data, 'w');\n                phantom.exit();\n            });\n        }\n    });\n}\n\n/****\n * 1. 抓取类名选择有问题，无法有效抓取\n * 2. JSON.parse处理后的JSON对象无法打印\n * 3. 如何删除重名文件\n *\n * *****/\n//# sourceMappingURL=task.js.map"]}